{"version":3,"file":"tinyjx.umd.js","sources":["tinyjx.js"],"sourcesContent":["/* global DEBUG */\nconst isFn = fn => typeof fn === 'function';\n\nconst isJSON = cType => /application\\/json/i.test(cType);\n\nconst isForm = cType => /application\\/x-www-form-urlencoded/i.test(cType);\n\nconst isStr = v => v && typeof v === 'string';\n\nconst isObj = o => Object.prototype.toString.call(o) === '[object Object]';\n\nconst lc = window.location;\n\nconst xhrPool = [],\n\tArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor,\n\tMIME = {\n\t\tjson: 'application/json',\n\t\tform: 'application/x-www-form-urlencoded',\n\t\thtml: 'text/html',\n\t\txml: 'application/xml',\n\t\ttext: 'text/plain'\n\t},\n\tevents = [\n\t\t'onloadstart',\n\t\t'onprogress',\n\t\t'onabort',\n\t\t'onerror',\n\t\t'onload',\n\t\t'ontimeout',\n\t\t'onloadend',\n\t\t'onreadystatechange'\n\t];\n\nlet jsonpId = Date.now(),\n\tcacheRand = Date.now() + 5,\n\tglobalSerialize = null,\n\tglobalDeserialize = null;\n\nif (DEBUG) {\n\tvar xhrId = 0;\n}\n\nfunction createXhr() {\n\tconst xhr = new XMLHttpRequest();\n\tObject.defineProperty(xhr, '_active', {\n\t\tvalue: false,\n\t\twritable: true,\n\t\tenumerable: false\n\t});\n\tif (DEBUG) {\n\t\tObject.defineProperty(xhr, '_id', {\n\t\t\tvalue: ++xhrId,\n\t\t\twritable: true,\n\t\t\tenumerable: false\n\t\t});\n\t}\n\treturn xhr;\n}\n\nfunction resetXhr(xhr) {\n\t// responseType, withCredentials以及header相关的会在open后重置\n\txhr._active = false;\n\t// 可能是同步请求那就不能设置timeout\n\ttry {\n\t\txhr.timeout = 0;\n\t\txhr.requestURL = '';\n\t\t/* eslint-disable-next-line */\n\t} catch (e) { }\n\tevents.forEach(v => (xhr[v] = null));\n\txhr.upload && events.forEach(v => (xhr.upload[v] = null));\n}\n\nfunction xhrFactory() {\n\tfor (let i = 0, len = xhrPool.length; i < len; ++i) {\n\t\tif (!xhrPool[i]._active) {\n\t\t\treturn xhrPool[i];\n\t\t}\n\t}\n\treturn createXhr();\n}\n\nfunction querystring(obj) {\n\tif (isObj(obj)) {\n\t\treturn Object.keys(obj)\n\t\t\t.map(\n\t\t\t\tk =>\n\t\t\t\t\tArray.isArray(obj[k])\n\t\t\t\t\t\t? obj[k]\n\t\t\t\t\t\t\t.map(v => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n\t\t\t\t\t\t\t.join('&')\n\t\t\t\t\t\t: `${encodeURIComponent(k)}=${encodeURIComponent(obj[k])}`\n\t\t\t)\n\t\t\t.join('&');\n\t} else {\n\t\treturn JSON.stringify(obj);\n\t}\n}\n\nfunction defaultSerialize({ data, method, contentType = MIME.json, url, cache }) {\n\tif (!cache) {\n\t\turl += ~url.indexOf('?') ? `&_=${++cacheRand}` : `?_=${++cacheRand}`;\n\t}\n\tif (method === 'GET' || method === 'HEAD') {\n\t\treturn {\n\t\t\turl,\n\t\t\tdata\n\t\t};\n\t}\n\tif (\n\t\tdata instanceof Document ||\n\t\t// URLSearchParams和ReadableStream暂时不考虑支持了, 浏览器版本要求比较高\n\t\t// data instanceof URLSearchParams ||\n\t\t// data instanceof ReadableStream ||\n\t\tdata instanceof Blob ||\n\t\tdata instanceof FormData ||\n\t\tdata instanceof ArrayBuffer ||\n\t\tdata instanceof ArrayBufferView ||\n\t\ttypeof data === 'string'\n\t) {\n\t\treturn {\n\t\t\turl,\n\t\t\tdata\n\t\t};\n\t}\n\tif (isJSON(contentType)) {\n\t\tdata = JSON.stringify(data);\n\t} else if (isForm(contentType)) {\n\t\tdata = querystring(data);\n\t} else {\n\t\tthrow new TypeError(\n\t\t\t'Unknown data type, you can provide a custom serialize function in options to override the default.'\n\t\t);\n\t}\n\treturn {\n\t\turl,\n\t\tdata\n\t};\n}\n\nfunction defaultDeserialize({ data, contentType, acceptType }) {\n\tlet rst = null;\n\tif (isStr(data) && (isJSON(contentType) || isJSON(acceptType))) {\n\t\ttry {\n\t\t\trst = JSON.parse(data);\n\t\t} catch (e) {\n\t\t\tconsole.error('Invalid json string');\n\t\t\trst = data;\n\t\t}\n\t} else {\n\t\trst = data;\n\t}\n\treturn rst;\n}\n\nfunction setHeaders(xhr, headers) {\n\tif (isObj(headers)) {\n\t\tObject.keys(headers).forEach(k => xhr.setRequestHeader(k, headers[k]));\n\t}\n}\n\nfunction isolateTryCatch({ xhr, reqData, acceptType, dslz, success, error, complete }) {\n\t// 这一坨有点恶心...考虑下怎么优化\n\t// 这里是为了捕获callback的异常, 以便最终可以reset\n\ttry {\n\t\tlet hasErrorCb = isFn(error),\n\t\t\thasCompleteCb = isFn(complete),\n\t\t\thasSuccessCb = isFn(success),\n\t\t\terrOccurred = false,\n\t\t\tresData = null;\n\t\t// 覆盖用户自定义\n\t\txhr.onreadystatechange = function (e) {\n\t\t\tif (this.readyState === 4) {\n\t\t\t\tif (\n\t\t\t\t\t!((this.status >= 200 && this.status < 300) || this.status == 304) &&\n\t\t\t\t\tthis.status !== 0\n\t\t\t\t) {\n\t\t\t\t\t// 404之类的错误会在这里捕获, try-catch不能捕获\n\t\t\t\t\terrOccurred = true;\n\t\t\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Remote server error. Request URL: ${this.requestURL}, Status code: ${this.status}, message: ${this.statusText}, response: ${this.responseText}.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// 异常不管直接抛\n\t\t\t\t\thasErrorCb && error(new Error(`Remote server error. Request URL: ${this.requestURL}, Status code: ${this.status}, message: ${this.statusText}.`), this, e);\n\t\t\t\t\thasCompleteCb && complete(this, 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// 同步不触发onerror, 这里是为了捕获网络异常h和跨域异常\n\t\ttry {\n\t\t\txhr.send(reqData || null);\n\t\t} catch (e) {\n\t\t\terrOccurred = true;\n\t\t\t// 没有监听异常事件也不要吞掉异常, 跨域错误会在这里被捕获\n\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\t// 异常不管直接抛\n\t\t\thasErrorCb && error(e, xhr, null);\n\t\t\thasCompleteCb && complete(xhr, 'error');\n\t\t}\n\t\tif (!errOccurred) {\n\t\t\tconst resCtype = xhr.getResponseHeader('Content-Type');\n\t\t\t// 这里也不捕获, 因为最外面已经捕获了\n\t\t\tresData = dslz({\n\t\t\t\tdata: getResponse(xhr, 'responseXML') || getResponse(xhr, 'response') || getResponse(xhr, 'responseText'),\n\t\t\t\tcontentType: resCtype,\n\t\t\t\tacceptType\n\t\t\t});\n\t\t\t// 异常直接抛, success不能在try中, 可能是success导致的异常进而使得控制流走向error\n\t\t\thasSuccessCb && success(resData, xhr, null);\n\t\t\thasCompleteCb && complete(xhr, 'success');\n\t\t}\n\t\t// loadend会在请求完成之后同步代码之前触发, 导致没办法依赖loadend来reset, 必须等到所有callback使用完xhr之后\n\t\t// xhr才算idle, 但是如果callback中异步引用了xhr也依然会有问题, 因为目的是希望所有callback执行完之后\n\t\t// 就不再使用xhr了, 避免xhr在下个请求中产生竞争, 除非不向callback暴露xhr, 但这也不现实\n\t\tresetXhr(xhr);\n\t\treturn resData;\n\t} catch (err) {\n\t\tresetXhr(xhr);\n\t\tthrow err;\n\t}\n}\n\nfunction setEvents(target, evts) {\n\tif (isObj(evts) && target) {\n\t\t// 不用addEventListener是它不方便reset\n\t\tObject.keys(evts)\n\t\t\t.filter(k => events.includes(k))\n\t\t\t.forEach(k => target[k] = evts[k]);\n\t}\n}\n\nfunction jsonp(options) {\n\tlet {\n\t\turl,\n\t\tcache = false,\n\t\tcrossorigin,\n\t\tcallbackName,\n\t\tsuccess,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\terror\n\t} = options;\n\n\tconst hasOriginalCb = isFn(window[callbackName]);\n\tif (isStr(callbackName) && !hasOriginalCb) {\n\t\tthrow new Error(`${callbackName} is not a function.`);\n\t}\n\n\tconst hasSuccessCb = isFn(success),\n\t\thasErrorCb = isFn(error),\n\t\thasCompleteCb = isFn(complete),\n\t\toriginalCb = hasOriginalCb ? window[callbackName] : undefined;\n\n\tif (!hasSuccessCb && !hasCompleteCb & !hasOriginalCb) {\n\t\tthrow new Error('Must set a success callback or complete callback.');\n\t}\n\tif (!isStr(url)) {\n\t\tthrow new TypeError(`url expected a non empty string, but received ${JSON.stringify(url)}.`);\n\t}\n\n\tconst hasCustomCbName = isStr(callbackName),\n\t\tcbName = hasCustomCbName ? callbackName : `jsonp${++jsonpId}`,\n\t\tscript = document.createElement('script');\n\n\tif (url.split('?').length < 3) {\n\t\t// 没有占位符的话默认callback\n\t\tconst qs = `callback=${encodeURIComponent(cbName)}`;\n\t\turl = ~url.indexOf('?') ? `${url}&${qs}` : `${url}?${qs}`;\n\t} else {\n\t\turl = url.replace(/\\?(.+)=\\?/, `?$1=${encodeURIComponent(cbName)}`);\n\t}\n\t!cache && (url += `&_=${++cacheRand}`);\n\n\tif (!window[cbName] || !window[cbName].hasHook) {\n\t\twindow[cbName] = function (...args) {\n\t\t\t// 放前面, 防止后面的callback抛异常导致删不掉\n\t\t\tif (!hasCustomCbName) {\n\t\t\t\tdelete window[cbName];\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tif (hasOriginalCb) {\n\t\t\t\t\toriginalCb(...args);\n\t\t\t\t} else if (hasSuccessCb) {\n\t\t\t\t\tsuccess(...args);\n\t\t\t\t}\n\t\t\t\thasCompleteCb && complete('success');\n\t\t\t\thasOriginalCb && (window[callbackName] = originalCb);\n\t\t\t} catch (e) {\n\t\t\t\t// 个人觉得应该crash掉让用户修复异常而不是继续执行complete\n\t\t\t\t// 所以这里只是为了还原window上原有的函数而不是为了吞掉异常\n\t\t\t\thasOriginalCb && (window[callbackName] = originalCb);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t};\n\t\twindow[cbName].hasHook = true;\n\t}\n\n\tscript.onerror = function (e) {\n\t\tdocument.body.removeChild(script);\n\t\tif (!hasCustomCbName) {\n\t\t\tdelete window[cbName];\n\t\t}\n\t\t// 都没有的话就继续抛出异常, 方便异常监控系统捕获\n\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\tthrow new Error(`Load script ${url} failed.`);\n\t\t}\n\t\thasErrorCb && error(new Error(`Load script ${url} failed.`), e);\n\t\thasCompleteCb && complete('error');\n\t};\n\n\tscript.onload = () => setTimeout(() => document.body.removeChild(script), 3000);\n\n\tcrossorigin && (script.crossOrigin = crossorigin);\n\tscript.src = url;\n\n\tif (isFn(beforeSend)) {\n\t\tsetTimeout(() => {\n\t\t\t// 允许拦截掉不发送请求\n\t\t\tconst rst = beforeSend(url, options);\n\t\t\trst !== false && document.body.appendChild(script);\n\t\t});\n\t} else {\n\t\tdocument.body.appendChild(script);\n\t}\n}\n\nfunction getResponse(xhr, key) {\n\t// 在有responseType的情况下, 访问responseXML, responseText等都有可能抛出异常\n\ttry {\n\t\treturn xhr[key];\n\t} catch (e) {\n\t\treturn null;\n\t}\n}\n\nfunction ajax(options) {\n\tlet {\n\t\turl = lc.href,\n\t\tmethod = 'GET',\n\t\tcontentType: reqCtype,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\tdata: reqRawData,\n\t\tdataType: acceptType = 'json',\n\t\terror,\n\t\theaders,\n\t\tmimeType,\n\t\tresponseType = '',\n\t\tusername,\n\t\tpassword,\n\t\tsuccess,\n\t\ttimeout = 0,\n\t\tontimeout,\n\t\tevents,\n\t\tuploadEvents,\n\t\twithCredentials = false,\n\t\tcache = true,\n\t\tserialize,\n\t\tdeserialize\n\t} = options;\n\n\tmethod = method.toUpperCase().trim();\n\t// IE是什么...\n\t// xhr不支持CONNECT, TRACE, TRACK方法\n\tif (!['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'].includes(method)) {\n\t\tthrow new Error(`Invalid HTTP method: ${method}`);\n\t}\n\t// 允许所有callback都没有\n\n\t// 准备数据\n\tif (isStr(reqCtype)) {\n\t\tMIME[reqCtype] && (reqCtype = MIME[reqCtype]);\n\t} else if (reqCtype) {\n\t\tthrow new TypeError(\n\t\t\t'contentType could be \"json\", \"form\", \"html\", \"xml\", \"text\" or other custom string.'\n\t\t);\n\t}\n\n\tconst slz = isFn(serialize)\n\t\t\t? serialize\n\t\t\t: isFn(globalSerialize)\n\t\t\t\t? globalSerialize\n\t\t\t\t: defaultSerialize,\n\t\tdslz = isFn(deserialize)\n\t\t\t? deserialize\n\t\t\t: isFn(globalDeserialize)\n\t\t\t\t? globalDeserialize\n\t\t\t\t: defaultDeserialize,\n\t\tmaybeProtocol = /^([\\w-]+:)\\/\\//.exec(url),\n\t\tprotocol = maybeProtocol ? maybeProtocol[1] : /^(https?):\\/\\//.exec(lc.href)[1],\n\t\txhr = xhrFactory(),\n\t\thasCompleteCb = isFn(complete),\n\t\thasErrorCb = isFn(error),\n\t\thasSuccessCb = isFn(success);\n\n\tlet reqData,\n\t\terrCalled = false,\n\t\tcompleteCalled = false;\n\t// 这里不用捕获异常去重置xhr是因为xhr还没激活\n\t({ url, data: reqData } = slz({ data: reqRawData, method, contentType: reqCtype, url, cache }));\n\n\t// 初始化xhr\n\txhr._active = true;\n\txhr.open(method, url, true, username, password);\n\t!xhr.requestURL && (xhr.requestURL = url);\n\n\t// 设置必要的头部\n\tif (reqCtype) {\n\t\txhr.setRequestHeader('Content-Type', reqCtype);\n\t} else if (isStr(reqData)) {\n\t\t// 不在默认参数设json是为了让FormData之类的能够由浏览器自己设置\n\t\t// 这里只对字符串的body设置默认为json\n\t\txhr.setRequestHeader('Content-Type', MIME.json);\n\t}\n\tif (isStr(acceptType)) {\n\t\tMIME[acceptType] && (acceptType = MIME[acceptType]);\n\t\txhr.setRequestHeader('Accept', acceptType);\n\t}\n\tsetHeaders(xhr, headers);\n\n\tisStr(mimeType) && xhr.overrideMimeType(mimeType);\n\n\t// 主要是给progress等事件用, 但存在破坏封装的风险\n\tsetEvents(xhr, events);\n\tsetEvents(xhr.upload, uploadEvents);\n\n\twithCredentials && (xhr.withCredentials = withCredentials);\n\tresponseType && (xhr.responseType = responseType);\n\ttimeout && (xhr.timeout = timeout);\n\tif (isFn(ontimeout)) {\n\t\txhr.ontimeout = function (e) {\n\t\t\tontimeout(e);\n\t\t\thasCompleteCb && complete(this, 'timeout');\n\t\t};\n\t} else if (timeout && !isFn(xhr.ontimeout)) {\n\t\txhr.ontimeout = function () {\n\t\t\tif (hasCompleteCb) {\n\t\t\t\tcomplete(this, 'timeout');\n\t\t\t} else {\n\t\t\t\t// 如果没监听ontimeout但是设置了timeout, window.onerror不会捕获这个错误, 所以手动抛个\n\t\t\t\tthrow new Error(`Request ${this.requestURL} timeout.`);\n\t\t\t}\n\t\t};\n\t}\n\n\t// loadend无论同步还是异步请求, 无论前面的事件是否抛异常, 它都会执行\n\tif (isFn(xhr.onloadend)) {\n\t\tconst originalLoadend = xhr.onloadend;\n\t\txhr.onloadend = function (e) {\n\t\t\tresetXhr(this);\n\t\t\toriginalLoadend.call(this, e);\n\t\t};\n\t} else {\n\t\txhr.onloadend = function () {\n\t\t\tresetXhr(this);\n\t\t};\n\t}\n\t// 覆盖掉用户自定义onreadystatechange\n\txhr.onreadystatechange = function (e) {\n\t\tif (this.readyState === 4) {\n\t\t\tif (\n\t\t\t\t(this.status >= 200 && this.status < 300) ||\n\t\t\t\tthis.status == 304 ||\n\t\t\t\t(this.status == 0 && protocol == 'file:')\n\t\t\t) {\n\t\t\t\tconst resCtype = this.getResponseHeader('Content-Type');\n\t\t\t\t// 这里也不用捕获异常, 因为xhr.onloadend会在之后帮我们回收xhr\n\t\t\t\tconst resData = dslz({\n\t\t\t\t\tdata: getResponse(xhr, 'responseXML') || getResponse(xhr, 'response') || getResponse(xhr, 'responseText'),\n\t\t\t\t\tcontentType: resCtype,\n\t\t\t\t\tacceptType\n\t\t\t\t});\n\t\t\t\t// 异常直接抛\n\t\t\t\thasSuccessCb && success(resData, this, e);\n\t\t\t\thasCompleteCb && complete(this, 'success');\n\t\t\t} else if (this.status !== 0) {\n\t\t\t\t// 这类错误xhr.onerror和window.onerror都不捕获所以手动抛一个\n\t\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Remote server error. Request URL: ${this.requestURL}, Status code: ${this.status}, message: ${this.statusText}, response: ${this.responseText}.`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\t// 理论上来讲好像没必要再注册xhr.onerror了, 因为如果有error那status必然为0\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status\n\t\t\t\t// 但是不加个心里不踏实...总感觉会不会有浏览器没按规范实现\n\t\t\t\t// 不过知名的库页都没监听onerror, 那说明应该是都按规范实现了的\n\t\t\t\t// 但是我要加!!!\n\t\t\t\tif (hasErrorCb) {\n\t\t\t\t\terrCalled = true;\n\t\t\t\t\terror(new Error(`Remote server error. Request URL: ${this.requestURL}, Status code: ${this.status}, message: ${this.statusText}, response: ${this.responseText}.`), this, e);\n\t\t\t\t}\n\t\t\t\tif (hasCompleteCb) {\n\t\t\t\t\tcompleteCalled = true;\n\t\t\t\t\tcomplete(this, 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// 覆盖\n\txhr.onerror = function (e) {\n\t\t// 跨域错误会在这里捕获, 但是window.onerror不捕获, 所以也手动抛一个\n\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\tthrow new Error(`An error occurred, maybe crossorigin error. Request URL: ${this.requestURL}, Status code: ${this.status}.`);\n\t\t}\n\t\tif (!errCalled && hasErrorCb) {\n\t\t\terror(new Error(`Network error or browser restricted. Request URL: ${this.requestURL}, Status code: ${this.status}`), this, e);\n\t\t}\n\t\tif (!completeCalled && hasCompleteCb) {\n\t\t\tcomplete(this, 'error');\n\t\t}\n\t};\n\n\t// 哎...都异步吧\n\tif (isFn(beforeSend)) {\n\t\tsetTimeout(() => {\n\t\t\tlet rst;\n\t\t\ttry {\n\t\t\t\trst = beforeSend(xhr, options);\n\t\t\t} catch (e) {\n\t\t\t\t// 恶心之处就在于每个用户定义的callback都可能触发异常, 然而我还要回收xhr\n\t\t\t\tresetXhr(xhr);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\tif (rst !== false) {\n\t\t\t\txhr.send(reqData || null);\n\t\t\t} else {\n\t\t\t\tresetXhr(xhr);\n\t\t\t}\n\t\t});\n\t} else {\n\t\txhr.send(reqData || null);\n\t}\n\t// 不暴露xhr\n\treturn {\n\t\tabort() {\n\t\t\txhr.abort();\n\t\t}\n\t};\n}\n\nfunction ajaxSync(options) {\n\t// 同步请求忽略timeout, responseType, withCredentials, 否则报错\n\t// 同步请求的callback都同步调用, 支持callback只是为了API保持一致\n\tlet {\n\t\turl = lc.href,\n\t\tmethod = 'GET',\n\t\tcontentType: reqCtype,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\tdata: reqRawData,\n\t\tdataType: acceptType = 'json',\n\t\terror,\n\t\theaders,\n\t\tmimeType,\n\t\tusername,\n\t\tpassword,\n\t\tsuccess,\n\t\tevents,\n\t\tuploadEvents,\n\t\tcache = true,\n\t\tserialize,\n\t\tdeserialize\n\t} = options;\n\n\tmethod = method.toUpperCase().trim();\n\t// IE是什么...\n\t// xhr不支持CONNECT, TRACE, TRACK方法\n\tif (!['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'].includes(method)) {\n\t\tthrow new Error(`Invalid HTTP method: ${method}`);\n\t}\n\t// 允许所有callback都没有\n\n\t// 准备数据\n\tif (isStr(reqCtype)) {\n\t\tMIME[reqCtype] && (reqCtype = MIME[reqCtype]);\n\t} else if (reqCtype) {\n\t\tthrow new TypeError(\n\t\t\t'contentType could be \"json\", \"form\", \"html\", \"xml\", \"text\" or other custom string.'\n\t\t);\n\t}\n\n\tconst slz = isFn(serialize)\n\t\t\t? serialize\n\t\t\t: isFn(globalSerialize)\n\t\t\t\t? globalSerialize\n\t\t\t\t: defaultSerialize,\n\t\tdslz = isFn(deserialize)\n\t\t\t? deserialize\n\t\t\t: isFn(globalDeserialize)\n\t\t\t\t? globalDeserialize\n\t\t\t\t: defaultDeserialize,\n\t\txhr = xhrFactory();\n\n\tlet reqData;\n\t({ url, data: reqData } = slz({ data: reqRawData, method, contentType: reqCtype, url, cache }));\n\n\t// 初始化xhr\n\txhr._active = true;\n\txhr.open(method, url, false, username, password);\n\t!xhr.requestURL && (xhr.requestURL = url);\n\n\t// 设置必要的头部\n\tif (reqCtype) {\n\t\txhr.setRequestHeader('Content-Type', reqCtype);\n\t} else if (isStr(reqData)) {\n\t\t// 不在默认参数设json是为了让FormData之类的能够由浏览器自己设置\n\t\t// 这里只对字符串的body设置默认为json\n\t\txhr.setRequestHeader('Content-Type', MIME.json);\n\t}\n\tif (isStr(acceptType)) {\n\t\tMIME[acceptType] && (acceptType = MIME[acceptType]);\n\t\txhr.setRequestHeader('Accept', acceptType);\n\t}\n\tsetHeaders(xhr, headers);\n\n\tisStr(mimeType) && xhr.overrideMimeType(mimeType);\n\n\t// 主要是给progress等事件用, 但存在破坏封装的风险\n\tsetEvents(xhr, events);\n\tsetEvents(xhr.upload, uploadEvents);\n\n\tif (isFn(beforeSend)) {\n\t\tlet rst;\n\t\ttry {\n\t\t\trst = beforeSend(xhr, options);\n\t\t} catch (e) {\n\t\t\tresetXhr(xhr);\n\t\t\tthrow e;\n\t\t}\n\t\tif (rst !== false) {\n\t\t\treturn isolateTryCatch({ xhr, reqData, acceptType, dslz, success, error, complete });\n\t\t} else {\n\t\t\tresetXhr(xhr);\n\t\t}\n\t} else {\n\t\treturn isolateTryCatch({ xhr, reqData, acceptType, dslz, success, error, complete });\n\t}\n}\n\nexport function config({ pool = false, serialize, deserialize } = {}) {\n\tif (pool) {\n\t\txhrPool.length = 0;\n\t\tlet poolSize = typeof pool === 'number' ? pool : 5;\n\t\tif (poolSize < 0) {\n\t\t\tthrow new Error('pool size must >= 0');\n\t\t}\n\t\twhile (poolSize--) {\n\t\t\txhrPool.push(createXhr());\n\t\t}\n\t}\n\tisFn(serialize) && (globalSerialize = serialize);\n\tisFn(deserialize) && (globalDeserialize = deserialize);\n}\n\nexport { ajax, ajaxSync, jsonp };\n\nexport function get(url, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tmethod: 'GET'\n\t});\n}\n\nexport function head(url, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tmethod: 'HEAD'\n\t});\n}\n\nexport function post(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'POST'\n\t});\n}\n\nexport function put(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'PUT'\n\t});\n}\n\nexport function del(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'DELETE'\n\t});\n}\n\nexport function patch(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'PATCH'\n\t});\n}\n\nexport function options(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'OPTIONS'\n\t});\n}\n"],"names":["isFn","fn","isJSON","cType","test","isForm","isStr","v","isObj","o","Object","prototype","toString","call","lc","window","location","xhrPool","ArrayBufferView","getPrototypeOf","Uint8Array","constructor","MIME","json","form","html","xml","text","events","jsonpId","Date","now","cacheRand","globalSerialize","globalDeserialize","xhrId","createXhr","xhr","XMLHttpRequest","defineProperty","value","writable","enumerable","resetXhr","_active","timeout","requestURL","e","forEach","upload","xhrFactory","i","len","length","querystring","obj","keys","map","k","Array","isArray","encodeURIComponent","join","JSON","stringify","defaultSerialize","data","method","contentType","url","cache","indexOf","Document","Blob","FormData","ArrayBuffer","TypeError","defaultDeserialize","acceptType","rst","parse","console","error","setHeaders","headers","setRequestHeader","isolateTryCatch","reqData","dslz","success","complete","hasErrorCb","hasCompleteCb","hasSuccessCb","errOccurred","resData","onreadystatechange","readyState","status","Error","statusText","responseText","send","resCtype","getResponseHeader","getResponse","err","setEvents","target","evts","filter","includes","jsonp","options","crossorigin","callbackName","beforeSend","hasOriginalCb","originalCb","undefined","hasCustomCbName","cbName","script","document","createElement","split","qs","replace","hasHook","onerror","body","removeChild","onload","setTimeout","crossOrigin","src","appendChild","key","ajax","href","reqCtype","reqRawData","dataType","mimeType","responseType","username","password","ontimeout","uploadEvents","withCredentials","serialize","deserialize","toUpperCase","trim","slz","maybeProtocol","exec","protocol","errCalled","completeCalled","open","overrideMimeType","onloadend","originalLoadend","abort","ajaxSync","config","pool","poolSize","push","get","head","post","put","del","patch"],"mappings":"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"}