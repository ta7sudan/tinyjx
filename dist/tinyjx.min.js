/**
 * @Version 3.1.1
 * @Author: ta7sudan
 * @Repo: https://github.com/ta7sudan/tinyjx#readme
 * @License: MIT
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.tinyjx={}))})(this,function(a){'use strict';function b(){const a=new XMLHttpRequest;return Object.defineProperty(a,"_active",{value:!1,writable:!0,enumerable:!1}),Object.defineProperty(a,"requestURL",{value:"",writable:!0,enumerable:!1}),a}function c(a){a._active=!1;try{a.timeout=0,a.requestURL=""}catch(a){}t.forEach(b=>a[b]=null),a.upload&&t.forEach(b=>a.upload[b]=null)}function d(){for(let a=0,b=q.length;a<b;++a)if(!q[a]._active)return q[a];return b()}function e(a){return o(a)?Object.keys(a).map(b=>{const c=a[b];return Array.isArray(c)?c.map(a=>`${encodeURIComponent(b)}=${encodeURIComponent(a)}`).join("&"):`${encodeURIComponent(b)}=${encodeURIComponent(c)}`}).join("&"):JSON.stringify(a)}function f(a,b){Object.keys(b).forEach(c=>a.setRequestHeader(c,b[c]))}function g(a,b){o(b)&&a&&Object.keys(b).filter(a=>-1!==t.indexOf(a)).forEach(c=>a[c]=b[c])}function h(a){let{url:b,cache:i=!1,crossorigin:c,callbackName:d,success:e,beforeSend:f,complete:g,error:h}=a;const j=d&&k(window[d]);if(n(d)&&!j)throw new Error(`${d} is not a function.`);const l=k(e),m=k(h),o=k(g),p=j?window[d]:void 0;if(!l&&!o&&!j)throw new Error("Must set a success callback or complete callback.");if(!n(b))throw new TypeError(`url expected a non empty string, but received ${JSON.stringify(b)}.`);const q=n(d),r=q?d:`jsonp${++u}`,s=document.createElement("script");if(3>b.split("?").length){const a=`callback=${encodeURIComponent(r)}`;b=~b.indexOf("?")?`${b}&${a}`:`${b}?${a}`}else b=b.replace(/\?(.+)=\?/,`?$1=${encodeURIComponent(r)}`);i||(b+=`&_=${++v}`);const t=window;t[r]&&t[r].hasHook||(t[r]=function(...a){q||delete t[r];try{j?p(...a):l&&e(...a),o&&g("success"),j&&(t[d]=p)}catch(a){throw j&&(t[d]=p),a}},t[r].hasHook=!0),s.onerror=function(a){if(document.body.removeChild(s),q||delete t[r],!m&&!o)throw new Error(`Load script ${b} failed.`);m&&h(new Error(`Load script ${b} failed.`),a),o&&g("error")},s.onload=()=>setTimeout(()=>document.body.removeChild(s),3e3),c&&(s.crossOrigin=c),s.src=b,k(f)?setTimeout(()=>{const c=f(b,a);!1!==c&&document.body.appendChild(s)}):document.body.appendChild(s)}function i(a,b){try{return a[b]}catch(a){return null}}function j(a){let{url:F=p.href,method:G="GET",contentType:b,dataType:H="json",processData:I=!0,data:e,beforeSend:h,complete:j,recoverableError:l,unrecoverableError:m,headers:q,mimeType:r,responseType:J="",username:t,password:u,success:v,timeout:K=0,ontimeout:A,events:B,uploadEvents:C,withCredentials:L=!1,cache:M=!0,serialize:D,deserialize:E}=a;if(G=G.toUpperCase().trim(),-1===["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].indexOf(G))throw new Error(`Invalid HTTP method: ${G}`);if(n(b))s[b]&&(b=s[b]);else if(b)throw new TypeError("contentType could be \"json\", \"form\", \"html\", \"xml\", \"text\" or other custom string.");const N=k(D)?D:k(w)?w:y,O=k(E)?E:k(x)?x:z,P=/^([\w-]+:)\/\//.exec(F),Q=/^(https?):\/\//.exec(p.href),R=P?P[1]:Q?Q[1]:null,S=d(),T=k(j),U=k(l),V=k(m),W=k(v);let X,Y=!1,Z=!1;if(({url:F,data:X}=N({data:e,method:G,processData:I,contentType:b,url:F,cache:M})),S._active=!0,S.open(G,F,!0,t,u),S.requestURL||(S.requestURL=F),b?S.setRequestHeader("Content-Type",b):n(X)&&S.setRequestHeader("Content-Type",s.json),n(H)&&(s[H]&&(H=s[H]),S.setRequestHeader("Accept",H)),o(q)&&f(S,q),n(r)&&S.overrideMimeType(r),g(S,B),g(S.upload,C),L&&(S.withCredentials=L),J&&(S.responseType=J),K&&(S.timeout=K),k(A)?S.ontimeout=function(a){A(a),T&&j(this,"timeout")}:K&&!k(S.ontimeout)&&(S.ontimeout=function(){if(T)j(this,"timeout");else throw new Error(`Request ${this.requestURL} timeout.`)}),k(S.onloadend)){const a=S.onloadend;S.onloadend=function(b){c(this),a.call(this,b)}}else S.onloadend=function(){c(this)};return S.onreadystatechange=function(a){if(4===this.readyState){const b=this.getResponseHeader("Content-Type"),c=O({data:i(S,"responseXML")||i(S,"response")||i(S,"responseText"),contentType:b,acceptType:H});if(200<=this.status&&300>this.status||304===this.status||0===this.status&&"file:"===R)W&&v(c,this,a),T&&j(this,"success");else if(0!==this.status){if(!U&&!T)throw new Error(`Remote server error. Request URL: ${this.requestURL}, Method: ${G}, Status code: ${this.status}, message: ${this.statusText}, response: ${this.responseText}.`);U&&(Y=!0,l(new Error(`Remote server error. Request URL: ${this.requestURL}, Method: ${G}, Status code: ${this.status}, message: ${this.statusText}, response: ${this.responseText}.`),c,this,a)),T&&(Z=!0,j(this,"error"))}}},S.onerror=function(a){if(!V&&!T)throw new Error(`An error occurred, maybe crossorigin error. Request URL: ${this.requestURL}, Method: ${G}, Status code: ${this.status}.`);!Y&&V&&m(new Error(`Network error or browser restricted. Request URL: ${this.requestURL}, Method: ${G}, Status code: ${this.status}`),this,a),!Z&&T&&j(this,"error")},k(h)?setTimeout(()=>{let b;try{b=h(S,a)}catch(a){throw c(S),a}!1===b?c(S):S.send(X||null)}):S.send(X||null),{abort(){S.abort()}}}const k=a=>"function"==typeof a,l=a=>/application\/json/i.test(a),m=a=>/application\/x-www-form-urlencoded/i.test(a),n=a=>a&&"string"==typeof a,o=a=>"[object Object]"===Object.prototype.toString.call(a),p=window.location,q=[],r=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor,s={json:"application/json",form:"application/x-www-form-urlencoded",html:"text/html",xml:"application/xml",text:"text/plain"},t=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];let u=Date.now(),v=Date.now()+5,w=null,x=null;const y=({data:a,method:b,processData:c,contentType:g=s.json,url:d,cache:f})=>{if(f||(d+=~d.indexOf("?")?`&_=${++v}`:`?_=${++v}`),"GET"===b||"HEAD"===b)return c&&(d+=~d.indexOf("?")?`&${e(a)}`:`?${e(a)}`),{url:d,data:a};if(a instanceof Document||a instanceof Blob||a instanceof FormData||a instanceof ArrayBuffer||a instanceof r||"string"==typeof a)return{url:d,data:a};let h=null;if(l(g))h=JSON.stringify(a);else if(m(g))h=e(a);else throw new TypeError("Unknown data type, you can provide a custom serialize function in options to override the default.");return{url:d,data:h}},z=({data:a,contentType:b,acceptType:c})=>{let d=null;if(n(a)&&(n(b)&&l(b)||l(c)))try{d=JSON.parse(a)}catch(b){console.error("Invalid json string"),d=a}else d=a;return d};a.config=function({pool:d=!1,serialize:a,deserialize:c}={}){if(d){q.length=0;let a="number"==typeof d?d:5;if(0>a)throw new Error("pool size must >= 0");for(;a--;)q.push(b())}k(a)&&(w=a),k(c)&&(x=c)},a.ajax=j,a.jsonp=h,a.get=function(a,b){return j(Object.assign({},b,{url:a,method:"GET"}))},a.head=function(a,b){return j(Object.assign({},b,{url:a,method:"HEAD"}))},a.post=function(a,b,c){return j(Object.assign({},c,{url:a,data:b,method:"POST"}))},a.put=function(a,b,c){return j(Object.assign({},c,{url:a,data:b,method:"PUT"}))},a.del=function(a,b,c){return j(Object.assign({},c,{url:a,data:b,method:"DELETE"}))},a.patch=function(a,b,c){return j(Object.assign({},c,{url:a,data:b,method:"PATCH"}))},a.options=function(a,b,c){return j(Object.assign({},c,{url:a,data:b,method:"OPTIONS"}))},Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=tinyjx.min.js.map
