/**
 * @Version 0.4.1
 * @Author: ta7sudan
 * @Repo: https://github.com/ta7sudan/tinyjx#readme
 * @License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.tinyjx={})}(this,function(e){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}var J=function(e){return"function"==typeof e},a=function(e){return/application\/json/i.test(e)},u=function(e){return/application\/x-www-form-urlencoded/i.test(e)},X=function(e){return e&&"string"==typeof e},c=function(e){return"[object Object]"===Object.prototype.toString.call(e)},B=window.location,d=[],l=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor,F={json:"application/json",form:"application/x-www-form-urlencoded",html:"text/html",xml:"application/xml",text:"text/plain"},n=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"],v=Date.now(),R=Date.now()+5,$=null,K=null;function p(){var e=new XMLHttpRequest;return Object.defineProperty(e,"_active",{value:!1,writable:!0,enumerable:!1}),e}function Q(t){t._active=!1;try{t.timeout=0,t.requestURL=""}catch(e){}n.forEach(function(e){return t[e]=null}),t.upload&&n.forEach(function(e){return t.upload[e]=null})}function V(){for(var e=0,t=d.length;e<t;++e)if(!d[e]._active)return d[e];return p()}function W(e){var r,t=e.data,o=e.method,n=e.contentType,s=void 0===n?F.json:n,i=e.url;if(e.cache||(i+=~i.indexOf("?")?"&_="+ ++R:"?_="+ ++R),"GET"===o||"HEAD"===o)return{url:i,data:t};if(t instanceof Document||t instanceof Blob||t instanceof FormData||t instanceof ArrayBuffer||t instanceof l||"string"==typeof t)return{url:i,data:t};if(a(s))t=JSON.stringify(t);else{if(!u(s))throw new TypeError("Unknown data type, you can provide a custom serialize function in options to override the default.");t=c(r=t)?Object.keys(r).map(function(t){return Array.isArray(r[t])?r[t].map(function(e){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&"):JSON.stringify(r)}return{url:i,data:t}}function Y(e){var t=e.data,r=e.contentType,o=e.acceptType,n=null;if(X(t)&&(a(r)||a(o)))try{n=JSON.parse(t)}catch(e){console.error("Invalid json string"),n=t}else n=t;return n}function Z(t,r){c(r)&&Object.keys(r).forEach(function(e){return t.setRequestHeader(e,r[e])})}function L(e){var t=e.xhr,r=e.reqData,o=e.acceptType,n=e.dslz,s=e.success,i=e.error,a=e.complete;try{var u=J(i),c=J(a),d=J(s),l=!1,p=null;t.onreadystatechange=function(e){if(4===this.readyState&&!(200<=this.status&&this.status<300||304==this.status)&&0!==this.status){if(l=!0,!u&&!c)throw new Error("Remote server error. Request URL: "+this.requestURL+", Status code: "+this.status+", message: "+this.statusText+", response: "+this.responseText+".");u&&i(new Error("Remote server error. Request URL: "+this.requestURL+", Status code: "+this.status+", message: "+this.statusText+"."),this,e),c&&a(this,"error")}};try{t.send(r||null)}catch(e){if(l=!0,!u&&!c)throw e;u&&i(e,t,null),c&&a(t,"error")}if(!l){var f=t.getResponseHeader("Content-Type");p=n({data:te(t,"responseXML")||te(t,"response")||te(t,"responseText"),contentType:f,acceptType:o}),d&&s(p,t,null),c&&a(t,"success")}return Q(t),p}catch(e){throw Q(t),e}}function ee(t,r){c(r)&&t&&Object.keys(r).filter(function(e){return-1!==n.indexOf(e)}).forEach(function(e){return t[e]=r[e]})}function te(e,t){try{return e[t]}catch(e){return null}}function s(t){var e=t.url,r=void 0===e?B.href:e,o=t.method,n=void 0===o?"GET":o,s=t.contentType,i=t.beforeSend,a=t.complete,u=t.data,c=t.dataType,d=void 0===c?"json":c,l=t.error,p=t.headers,f=t.mimeType,h=t.responseType,m=void 0===h?"":h,y=t.username,w=t.password,T=t.success,v=t.timeout,R=void 0===v?0:v,E=t.ontimeout,x=t.events,b=t.uploadEvents,O=t.withCredentials,g=void 0!==O&&O,j=t.cache,U=void 0===j||j,q=t.serialize,L=t.deserialize;if(n=n.toUpperCase().trim(),-1===["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].indexOf(n))throw new Error("Invalid HTTP method: "+n);if(X(s))F[s]&&(s=F[s]);else if(s)throw new TypeError('contentType could be "json", "form", "html", "xml", "text" or other custom string.');var C,S=J(q)?q:J($)?$:W,H=J(L)?L:J(K)?K:Y,P=/^([\w-]+:)\/\//.exec(r),A=P?P[1]:/^(https?):\/\//.exec(B.href)[1],D=V(),I=J(a),k=J(l),z=J(T),_=!1,N=!1,M=S({data:u,method:n,contentType:s,url:r,cache:U});if(r=M.url,C=M.data,D._active=!0,D.open(n,r,!0,y,w),!D.requestURL&&(D.requestURL=r),s?D.setRequestHeader("Content-Type",s):X(C)&&D.setRequestHeader("Content-Type",F.json),X(d)&&(F[d]&&(d=F[d]),D.setRequestHeader("Accept",d)),Z(D,p),X(f)&&D.overrideMimeType(f),ee(D,x),ee(D.upload,b),g&&(D.withCredentials=g),m&&(D.responseType=m),R&&(D.timeout=R),J(E)?D.ontimeout=function(e){E(e),I&&a(this,"timeout")}:R&&!J(D.ontimeout)&&(D.ontimeout=function(){if(!I)throw new Error("Request "+this.requestURL+" timeout.");a(this,"timeout")}),J(D.onloadend)){var G=D.onloadend;D.onloadend=function(e){Q(this),G.call(this,e)}}else D.onloadend=function(){Q(this)};return D.onreadystatechange=function(e){if(4===this.readyState){var t=this.getResponseHeader("Content-Type"),r=H({data:te(D,"responseXML")||te(D,"response")||te(D,"responseText"),contentType:t,acceptType:d});if(200<=this.status&&this.status<300||304==this.status||0==this.status&&"file:"==A)z&&T(r,this,e),I&&a(this,"success");else if(0!==this.status){if(!k&&!I)throw new Error("Remote server error. Request URL: "+this.requestURL+", Status code: "+this.status+", message: "+this.statusText+", response: "+this.responseText+".");k&&(_=!0,l(new Error("Remote server error. Request URL: "+this.requestURL+", Status code: "+this.status+", message: "+this.statusText+", response: "+this.responseText+"."),r,this,e)),I&&(N=!0,a(this,"error"))}}},D.onerror=function(e){if(!k&&!I)throw new Error("An error occurred, maybe crossorigin error. Request URL: "+this.requestURL+", Status code: "+this.status+".");!_&&k&&l(new Error("Network error or browser restricted. Request URL: "+this.requestURL+", Status code: "+this.status),void 0,this,e),!N&&I&&a(this,"error")},J(i)?setTimeout(function(){var e;try{e=i(D,t)}catch(e){throw Q(D),e}!1!==e?D.send(C||null):Q(D)}):D.send(C||null),{abort:function(){D.abort()}}}e.config=function(e){var t=void 0===e?{}:e,r=t.pool,o=void 0!==r&&r,n=t.serialize,s=t.deserialize;if(o){var i="number"==typeof o?o:5;if(i<(d.length=0))throw new Error("pool size must >= 0");for(;i--;)d.push(p())}J(n)&&($=n),J(s)&&(K=s)},e.ajax=s,e.ajaxSync=function(e){var t=e.url,r=void 0===t?B.href:t,o=e.method,n=void 0===o?"GET":o,s=e.contentType,i=e.beforeSend,a=e.complete,u=e.data,c=e.dataType,d=void 0===c?"json":c,l=e.error,p=e.headers,f=e.mimeType,h=e.username,m=e.password,y=e.success,w=e.events,T=e.uploadEvents,v=e.cache,R=void 0===v||v,E=e.serialize,x=e.deserialize;if(n=n.toUpperCase().trim(),-1===["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].indexOf(n))throw new Error("Invalid HTTP method: "+n);if(X(s))F[s]&&(s=F[s]);else if(s)throw new TypeError('contentType could be "json", "form", "html", "xml", "text" or other custom string.');var b,O,g=J(E)?E:J($)?$:W,j=J(x)?x:J(K)?K:Y,U=V(),q=g({data:u,method:n,contentType:s,url:r,cache:R});if(r=q.url,b=q.data,U._active=!0,U.open(n,r,!1,h,m),!U.requestURL&&(U.requestURL=r),s?U.setRequestHeader("Content-Type",s):X(b)&&U.setRequestHeader("Content-Type",F.json),X(d)&&(F[d]&&(d=F[d]),U.setRequestHeader("Accept",d)),Z(U,p),X(f)&&U.overrideMimeType(f),ee(U,w),ee(U.upload,T),!J(i))return L({xhr:U,reqData:b,acceptType:d,dslz:j,success:y,error:l,complete:a});try{O=i(U,e)}catch(e){throw Q(U),e}if(!1!==O)return L({xhr:U,reqData:b,acceptType:d,dslz:j,success:y,error:l,complete:a});Q(U)},e.jsonp=function(e){var t=e.url,r=e.cache,o=void 0!==r&&r,n=e.crossorigin,s=e.callbackName,i=e.success,a=e.beforeSend,u=e.complete,c=e.error,d=J(window[s]);if(X(s)&&!d)throw new Error(s+" is not a function.");var l=J(i),p=J(c),f=J(u),h=d?window[s]:void 0;if(!l&&!f&!d)throw new Error("Must set a success callback or complete callback.");if(!X(t))throw new TypeError("url expected a non empty string, but received "+JSON.stringify(t)+".");var m=X(s),y=m?s:"jsonp"+ ++v,w=document.createElement("script");if(t.split("?").length<3){var T="callback="+encodeURIComponent(y);t=~t.indexOf("?")?t+"&"+T:t+"?"+T}else t=t.replace(/\?(.+)=\?/,"?$1="+encodeURIComponent(y));!o&&(t+="&_="+ ++R),window[y]&&window[y].hasHook||(window[y]=function(){m||delete window[y];try{d?h.apply(void 0,arguments):l&&i.apply(void 0,arguments),f&&u("success"),d&&(window[s]=h)}catch(e){throw d&&(window[s]=h),e}},window[y].hasHook=!0),w.onerror=function(e){if(document.body.removeChild(w),m||delete window[y],!p&&!f)throw new Error("Load script "+t+" failed.");p&&c(new Error("Load script "+t+" failed."),e),f&&u("error")},w.onload=function(){return setTimeout(function(){return document.body.removeChild(w)},3e3)},n&&(w.crossOrigin=n),w.src=t,J(a)?setTimeout(function(){!1!==a(t,e)&&document.body.appendChild(w)}):document.body.appendChild(w)},e.get=function(e,t){return s(o({},t,{url:e,method:"GET"}))},e.head=function(e,t){return s(o({},t,{url:e,method:"HEAD"}))},e.post=function(e,t,r){return s(o({},r,{url:e,data:t,method:"POST"}))},e.put=function(e,t,r){return s(o({},r,{url:e,data:t,method:"PUT"}))},e.del=function(e,t,r){return s(o({},r,{url:e,data:t,method:"DELETE"}))},e.patch=function(e,t,r){return s(o({},r,{url:e,data:t,method:"PATCH"}))},e.options=function(e,t,r){return s(o({},r,{url:e,data:t,method:"OPTIONS"}))},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tinyjx.min.js.map
