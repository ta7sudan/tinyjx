/**
 * @Version 0.1.1
 * @Author: ta7sudan
 * @Repo: https://github.com/ta7sudan/tinyjx#readme
 * @License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.tinyjx={})}(this,function(e){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}var G=function(e){return"function"==typeof e},a=function(e){return/application\/json/i.test(e)},c=function(e){return/application\/x-www-form-urlencoded/i.test(e)},J=function(e){return e&&"string"==typeof e},u=function(e){return"[object Object]"===Object.prototype.toString.call(e)},d=[],l=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array)).constructor,X={json:"application/json",form:"application/x-www-form-urlencoded",html:"text/html",xml:"application/xml",text:"text/plain"},r=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"],v=Date.now(),E=Date.now()+5,B=null,F=null;function p(){var e=new XMLHttpRequest;return Object.defineProperty(e,"_active",{value:!1,writable:!0,enumerable:!1}),e}function $(t){t._active=!1;try{t.timeout=0}catch(e){}r.forEach(function(e){return t[e]=null}),t.upload&&r.forEach(function(e){return t.upload[e]=null})}function K(){for(var e=0,t=d.length;e<t;++e)if(!d[e]._active)return d[e];return p()}function Q(e){var r,t=e.data,o=e.method,n=e.contentType,i=void 0===n?X.json:n,s=e.url;if(e.cache||(s+=~s.indexOf("?")?"&_="+ ++E:"?_="+ ++E),"GET"===o||"HEAD"===o)return{url:s,data:t};if(t instanceof Document||t instanceof Blob||t instanceof FormData||t instanceof ArrayBuffer||t instanceof l||"string"==typeof t)return{url:s,data:t};if(a(i))t=JSON.stringify(t);else{if(!c(i))throw new TypeError("Unknown data type, you can provide a custom serialize function in options to override the default.");t=u(r=t)?Object.keys(r).map(function(t){return Array.isArray(r[t])?r[t].map(function(e){return encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e))}).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(r[t]))}).join("&"):JSON.stringify(r)}return{url:s,data:t}}function V(e){var t=e.data,r=e.contentType,o=e.acceptType,n=null;if(J(t)&&(a(r)||a(o)))try{n=JSON.parse(t)}catch(e){console.error("Invalid json string"),n=t}return n}function W(t,r){u(r)&&Object.keys(r).forEach(function(e){return t.setRequestHeader(e,r[e])})}function H(e){var t=e.xhr,r=e.reqData,o=e.acceptType,n=e.dslz,i=e.success,s=e.error,a=e.complete;try{var c=G(s),u=G(a),d=G(i),l=!1,p=null;t.onreadystatechange=function(e){if(4===this.readyState&&!(200<=this.status&&this.status<300||304==this.status)&&0!==this.status){if(l=!0,!c&&!u)throw new Error("Remote server error. Status code: "+this.status+", message: "+this.statusText+".");c&&s(new Error("Remote server error. Status code: "+this.status+", message: "+this.statusText+"."),t,e),u&&a(t,"error")}};try{t.send(r||null)}catch(e){if(l=!0,!c&&!u)throw e;c&&s(e,t,null),u&&a(t,"error")}if(!l){var f=t.getResponseHeader("Content-Type");p=n({data:t.responseXML||t.response||t.responseText,contentType:f,acceptType:o}),d&&i(p,t,null),u&&a(t,"success")}return $(t),p}catch(e){throw $(t),e}}function Y(t,e){u(e)&&t&&Object.keys(e).filter(function(e){return-1!==r.indexOf(e)}).forEach(function(e){return t[e]=r[e]})}function n(e){var t=e.url,r=void 0===t?location.href:t,o=e.method,n=void 0===o?"GET":o,i=e.contentType,s=e.beforeSend,a=e.complete,c=e.data,u=e.dataType,d=void 0===u?"json":u,l=e.error,p=e.headers,f=e.mimeType,h=e.responseType,m=void 0===h?"":h,y=e.username,w=e.password,T=e.success,v=e.timeout,E=void 0===v?0:v,b=e.ontimeout,O=e.events,g=e.uploadEvents,x=e.withCredentials,j=void 0!==x&&x,S=e.cache,C=void 0===S||S,H=e.serialize,R=e.deserialize;if(n=n.toUpperCase().trim(),-1===["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].indexOf(n))throw new Error("Invalid HTTP method: "+n);if(J(i))X[i]&&(i=X[i]);else if(i)throw new TypeError('contentType could be "json", "form", "html", "xml", "text" or other custom string.');var P,A=G(H)?H:G(B)?B:Q,D=G(R)?R:G(F)?F:V,U=/^([\w-]+:)\/\//.exec(r)[1],q=K(),I=G(a),k=G(l),z=G(T),N=!1,_=!1,L=A({data:c,method:n,contentType:i,url:r,cache:C});if(r=L.url,P=L.data,q._active=!0,q.open(n,r,!0,y,w),i?q.setRequestHeader("Content-Type",i):J(P)&&q.setRequestHeader("Content-Type",X.json),J(d)&&(X[d]&&(d=X[d]),q.setRequestHeader("Accept",d)),W(q,p),J(f)&&q.overrideMimeType(f),Y(q,O),Y(q.upload,g),j&&(q.withCredentials=j),m&&(q.responseType=m),E&&(q.timeout=E),G(b)?q.ontimeout=b.bind(null):E&&!G(q.ontimeout)&&(q.ontimeout=function(){throw new Error("Request "+r+" timeout.")}),G(q.onloadend)){var M=q.onloadend;q.onloadend=function(e){$(this),M.call(this,e)}}else q.onloadend=function(){$(this)};return q.onreadystatechange=function(e){if(4===this.readyState)if(200<=this.status&&this.status<300||304==this.status||0==this.status&&"file:"==U){var t=this.getResponseHeader("Content-Type"),r=D({data:this.responseXML||this.response||this.responseText,contentType:t,acceptType:d});z&&T(r,this,e),I&&a(this,"success")}else if(0!==this.status){if(!k&&!I)throw new Error("Remote server error. Status code: "+this.status+", message: "+this.statusText+".");k&&(N=!0,l(new Error("Remote server error. Status code "+this.status),this,e)),I&&(_=!0,a(this,"error"))}},q.onerror=function(e){if(!k&&!I)throw new Error("An error occured, maybe crossorigin error. Status code: "+this.status+".");!N&&k&&l(new Error("Network error or browser restricted."),this,e),!_&&I&&a(this,"error")},G(s)?setTimeout(function(){!1!==s(q,e)&&q.send(P||null)}):q.send(P||null),{abort:function(){q.abort()}}}e.config=function(e){var t=void 0===e?{}:e,r=t.pool,o=void 0!==r&&r,n=t.serialize,i=t.deserialize;if(o){var s="number"==typeof o?o:5;if(s<(d.length=0))throw new Error("pool size must >= 0");for(;s--;)d.push(p())}G(n)&&(B=n),G(i)&&(F=i)},e.ajax=n,e.ajaxSync=function(e){var t=e.url,r=void 0===t?location.href:t,o=e.method,n=void 0===o?"GET":o,i=e.contentType,s=e.beforeSend,a=e.complete,c=e.data,u=e.dataType,d=void 0===u?"json":u,l=e.error,p=e.headers,f=e.mimeType,h=e.username,m=e.password,y=e.success,w=e.events,T=e.uploadEvents,v=e.cache,E=void 0===v||v,b=e.serialize,O=e.deserialize;if(n=n.toUpperCase().trim(),-1===["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].indexOf(n))throw new Error("Invalid HTTP method: "+n);if(J(i))X[i]&&(i=X[i]);else if(i)throw new TypeError('contentType could be "json", "form", "html", "xml", "text" or other custom string.');var g,x=G(b)?b:G(B)?B:Q,j=G(O)?O:G(F)?F:V,S=K(),C=x({data:c,method:n,contentType:i,url:r,cache:E});return r=C.url,g=C.data,S._active=!0,S.open(n,r,!1,h,m),i?S.setRequestHeader("Content-Type",i):J(g)&&S.setRequestHeader("Content-Type",X.json),J(d)&&(X[d]&&(d=X[d]),S.setRequestHeader("Accept",d)),W(S,p),J(f)&&S.overrideMimeType(f),Y(S,w),Y(S.upload,T),G(s)?!1!==s(S,e)&&H({xhr:S,reqData:g,acceptType:d,dslz:j,success:y,error:l,complete:a}):H({xhr:S,reqData:g,acceptType:d,dslz:j,success:y,error:l,complete:a})},e.jsonp=function(e){var t=e.url,r=e.cache,o=void 0!==r&&r,n=e.crossorigin,i=e.callbackName,s=e.success,a=e.beforeSend,c=e.complete,u=e.error,d=G(window[i]);if(J(i)&&!d)throw new Error(i+" is not a function.");var l=G(s),p=G(u),f=G(c),h=d?window[i]:void 0;if(!l&&!f&!d)throw new Error("Must set a success callback or complete callback.");if(!J(t))throw new TypeError("url expected a non empty string, but received "+JSON.stringify(t)+".");var m=J(i),y=m?i:"jsonp"+ ++v,w=document.createElement("script");if(t.split("?").length<3){var T="callback="+encodeURIComponent(y);t=~t.indexOf("?")?t+"&"+T:t+"?"+T}else t=t.replace(/\?(.+)=\?/,"?$1="+encodeURIComponent(y));!o&&(t+="&_="+ ++E),window[y]&&window[y].hasHook||(window[y]=function(){m||delete window[y];try{d?h.apply(void 0,arguments):l&&s.apply(void 0,arguments),f&&c("success"),d&&(window[i]=h)}catch(e){throw d&&(window[i]=h),e}},window[y].hasHook=!0),w.onerror=function(e){if(document.body.removeChild(w),m||delete window[y],!p&&!f)throw new Error("Load script "+t+" failed.");p&&u(new Error("Load script "+t+" failed."),e),f&&c("error")},w.onload=function(){return setTimeout(function(){return document.body.removeChild(w)},3e3)},n&&(w.crossOrigin=n),w.src=t,G(a)?setTimeout(function(){!1!==a(t,e)&&document.body.appendChild(w)}):document.body.appendChild(w)},e.get=function(e,t){return n(o({},t,{url:e,method:"GET"}))},e.head=function(e,t){return n(o({},t,{url:e,method:"HEAD"}))},e.post=function(e,t,r){return n(o({},r,{url:e,data:t,method:"POST"}))},e.put=function(e,t,r){return n(o({},r,{url:e,data:t,method:"PUT"}))},e.del=function(e,t,r){return n(o({},r,{url:e,data:t,method:"DELETE"}))},e.patch=function(e,t,r){return n(o({},r,{url:e,data:t,method:"PATCH"}))},e.options=function(e,t,r){return n(o({},r,{url:e,data:t,method:"OPTIONS"}))},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=tinyjx.min.js.map
