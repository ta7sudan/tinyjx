{"version":3,"file":"tinyjx.esm.js","sources":["../src/index.js"],"sourcesContent":["/* global DEBUG */\nconst isFn = fn => typeof fn === 'function';\n\nconst isJSON = cType => /application\\/json/i.test(cType);\n\nconst isForm = cType => /application\\/x-www-form-urlencoded/i.test(cType);\n\nconst isStr = v => v && typeof v === 'string';\n\nconst isObj = o => Object.prototype.toString.call(o) === '[object Object]';\n\nconst xhrPool = [],\n\tArrayBufferView = Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array())).constructor,\n\tMIME = {\n\t\tjson: 'application/json',\n\t\tform: 'application/x-www-form-urlencoded',\n\t\thtml: 'text/html',\n\t\txml: 'application/xml',\n\t\ttext: 'text/plain'\n\t},\n\tevents = [\n\t\t'onloadstart',\n\t\t'onprogress',\n\t\t'onabort',\n\t\t'onerror',\n\t\t'onload',\n\t\t'ontimeout',\n\t\t'onloadend',\n\t\t'onreadystatechange'\n\t];\n\nlet jsonpId = Date.now(),\n\tcacheRand = Date.now() + 5,\n\tglobalSerialize = null,\n\tglobalDeserialize = null;\n\nif (DEBUG) {\n\tvar xhrId = 0;\n}\n\nfunction createXhr() {\n\tconst xhr = new XMLHttpRequest();\n\tObject.defineProperty(xhr, '_active', {\n\t\tvalue: false,\n\t\twritable: true,\n\t\tenumerable: false\n\t});\n\tif (DEBUG) {\n\t\tObject.defineProperty(xhr, '_id', {\n\t\t\tvalue: ++xhrId,\n\t\t\twritable: true,\n\t\t\tenumerable: false\n\t\t});\n\t}\n\treturn xhr;\n}\n\nfunction resetXhr(xhr) {\n\t// responseType, withCredentials以及header相关的会在open后重置\n\txhr._active = false;\n\t// 可能是同步请求那就不能设置timeout\n\ttry {\n\t\txhr.timeout = 0;\n\t\t/* eslint-disable-next-line */\n\t} catch (e) {}\n\tevents.forEach(v => (xhr[v] = null));\n\txhr.upload && events.forEach(v => (xhr.upload[v] = null));\n}\n\nfunction xhrFactory() {\n\tfor (let i = 0, len = xhrPool.length; i < len; ++i) {\n\t\tif (!xhrPool[i]._active) {\n\t\t\treturn xhrPool[i];\n\t\t}\n\t}\n\treturn createXhr();\n}\n\nfunction querystring(obj) {\n\tif (isObj(obj)) {\n\t\treturn Object.keys(obj)\n\t\t\t.map(\n\t\t\t\tk =>\n\t\t\t\t\tArray.isArray(obj[k])\n\t\t\t\t\t\t? obj[k]\n\t\t\t\t\t\t\t.map(v => `${encodeURIComponent(k)}=${encodeURIComponent(JSON.stringify(v))}`)\n\t\t\t\t\t\t\t.join('&')\n\t\t\t\t\t\t: `${encodeURIComponent(k)}=${encodeURIComponent(JSON.stringify(obj[k]))}`\n\t\t\t)\n\t\t\t.join('&');\n\t} else {\n\t\treturn JSON.stringify(obj);\n\t}\n}\n\nfunction defaultSerialize({data, method, contentType = MIME.json, url, cache}) {\n\tif (!cache) {\n\t\turl += ~url.indexOf('?') ? `&_=${++cacheRand}` : `?_=${++cacheRand}`;\n\t}\n\tif (method === 'GET' || method === 'HEAD') {\n\t\treturn {\n\t\t\turl,\n\t\t\tdata\n\t\t};\n\t}\n\tif (\n\t\tdata instanceof Document ||\n\t\t// URLSearchParams和ReadableStream暂时不考虑支持了, 浏览器版本要求比较高\n\t\t// data instanceof URLSearchParams ||\n\t\t// data instanceof ReadableStream ||\n\t\tdata instanceof Blob ||\n\t\tdata instanceof FormData ||\n\t\tdata instanceof ArrayBuffer ||\n\t\tdata instanceof ArrayBufferView ||\n\t\ttypeof data === 'string'\n\t) {\n\t\treturn {\n\t\t\turl,\n\t\t\tdata\n\t\t};\n\t}\n\tif (isJSON(contentType)) {\n\t\tdata = JSON.stringify(data);\n\t} else if (isForm(contentType)) {\n\t\tdata = querystring(data);\n\t} else {\n\t\tthrow new TypeError(\n\t\t\t'Unknown data type, you can provide a custom serialize function in options to override the default.'\n\t\t);\n\t}\n\treturn {\n\t\turl,\n\t\tdata\n\t};\n}\n\nfunction defaultDeserialize({data, contentType, acceptType}) {\n\tlet rst = null;\n\tif (isStr(data) && (isJSON(contentType) || isJSON(acceptType))) {\n\t\ttry {\n\t\t\trst = JSON.parse(data);\n\t\t} catch (e) {\n\t\t\tconsole.error('Invalid json string');\n\t\t\trst = data;\n\t\t}\n\t}\n\treturn rst;\n}\n\nfunction setHeaders(xhr, headers) {\n\tif (isObj(headers)) {\n\t\tObject.keys(headers).forEach(k => xhr.setRequestHeader(k, headers[k]));\n\t}\n}\n\nfunction isolateTryCatch({xhr, reqData, acceptType, dslz, success, error, complete}) {\n\t// 这一坨有点恶心...考虑下怎么优化\n\t// 这里是为了捕获callback的异常, 以便最终可以reset\n\ttry {\n\t\tlet hasErrorCb = isFn(error),\n\t\t\thasCompleteCb = isFn(complete),\n\t\t\thasSuccessCb = isFn(success),\n\t\t\terrOccured = false,\n\t\t\tresData = null;\n\t\t// 覆盖用户自定义\n\t\txhr.onreadystatechange = function (e) {\n\t\t\tif (this.readyState === 4) {\n\t\t\t\tif (\n\t\t\t\t\t!((this.status >= 200 && this.status < 300) || this.status == 304) &&\n\t\t\t\t\tthis.status !== 0\n\t\t\t\t) {\n\t\t\t\t\t// 404之类的错误会在这里捕获, try-catch不能捕获\n\t\t\t\t\terrOccured = true;\n\t\t\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Remote server error. Status code: ${this.status}, message: ${this.statusText}.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// 异常不管直接抛\n\t\t\t\t\thasErrorCb && error(new Error(`Remote server error. Status code: ${this.status}, message: ${this.statusText}.`), xhr, e);\n\t\t\t\t\thasCompleteCb && complete(xhr, 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// 同步不触发onerror, 这里是为了捕获网络异常h和跨域异常\n\t\ttry {\n\t\t\txhr.send(reqData || null);\n\t\t} catch (e) {\n\t\t\terrOccured = true;\n\t\t\t// 没有监听异常事件也不要吞掉异常, 跨域错误会在这里被捕获\n\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\t// 异常不管直接抛\n\t\t\thasErrorCb && error(e, xhr, null);\n\t\t\thasCompleteCb && complete(xhr, 'error');\n\t\t}\n\t\tif (!errOccured) {\n\t\t\tconst resCtype = xhr.getResponseHeader('Content-Type');\n\t\t\tresData = dslz({\n\t\t\t\tdata: xhr.responseXML || xhr.response || xhr.responseText,\n\t\t\t\tcontentType: resCtype,\n\t\t\t\tacceptType\n\t\t\t});\n\t\t\t// 异常直接抛, success不能在try中, 可能是success导致的异常进而使得控制流走向error\n\t\t\thasSuccessCb && success(resData, xhr, null);\n\t\t\thasCompleteCb && complete(xhr, 'success');\n\t\t}\n\t\t// loadend会在请求完成之后同步代码之前触发, 导致没办法依赖loadend来reset, 必须等到所有callback使用完xhr之后\n\t\t// xhr才算idle, 但是如果callback中异步引用了xhr也依然会有问题, 因为目的是希望所有callback执行完之后\n\t\t// 就不再使用xhr了, 避免xhr在下个请求中产生竞争, 除非不向callback暴露xhr, 但这也不现实\n\t\tresetXhr(xhr);\n\t\treturn resData;\n\t} catch (err) {\n\t\tresetXhr(xhr);\n\t\tthrow err;\n\t}\n}\n\nfunction setEvents(target, evts) {\n\tif (isObj(evts) && target) {\n\t\t// 不用addEventListener是它不方便reset\n\t\tObject.keys(evts)\n\t\t\t.filter(k => events.includes(k))\n\t\t\t.forEach(k => (target[k] = events[k]));\n\t}\n}\n\nfunction jsonp(options) {\n\tlet {\n\t\turl,\n\t\tcache = false,\n\t\tcrossorigin,\n\t\tcallbackName,\n\t\tsuccess,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\terror\n\t} = options;\n\n\tconst hasOriginalCb = isFn(window[callbackName]);\n\tif (isStr(callbackName) && !hasOriginalCb) {\n\t\tthrow new Error(`${callbackName} is not a function.`);\n\t}\n\n\tconst hasSuccessCb = isFn(success),\n\t\thasErrorCb = isFn(error),\n\t\thasCompleteCb = isFn(complete),\n\t\toriginalCb = hasOriginalCb ? window[callbackName] : undefined;\n\n\tif (!hasSuccessCb && !hasCompleteCb & !hasOriginalCb) {\n\t\tthrow new Error('Must set a success callback or complete callback.');\n\t}\n\tif (!isStr(url)) {\n\t\tthrow new TypeError(`url expected a non empty string, but received ${JSON.stringify(url)}.`);\n\t}\n\n\tconst hasCustomCbName = isStr(callbackName),\n\t\tcbName = hasCustomCbName ? callbackName : `jsonp${++jsonpId}`,\n\t\tscript = document.createElement('script');\n\n\tif (url.split('?').length < 3) {\n\t\t// 没有占位符的话默认callback\n\t\tconst qs = `callback=${encodeURIComponent(cbName)}`;\n\t\turl = ~url.indexOf('?') ? `${url}&${qs}` : `${url}?${qs}`;\n\t} else {\n\t\turl = url.replace(/\\?(.+)=\\?/, `?$1=${encodeURIComponent(cbName)}`);\n\t}\n\t!cache && (url += `&_=${++cacheRand}`);\n\n\tif (!window[cbName] || !window[cbName].hasHook) {\n\t\twindow[cbName] = function (...args) {\n\t\t\t// 放前面, 防止后面的callback抛异常导致删不掉\n\t\t\tif (!hasCustomCbName) {\n\t\t\t\tdelete window[cbName];\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tif (hasOriginalCb) {\n\t\t\t\t\toriginalCb(...args);\n\t\t\t\t} else if (hasSuccessCb) {\n\t\t\t\t\tsuccess(...args);\n\t\t\t\t}\n\t\t\t\t// hasSuccessCb && success(...args);\n\t\t\t\thasCompleteCb && complete('success');\n\t\t\t\thasOriginalCb && (window[callbackName] = originalCb);\n\t\t\t} catch (e) {\n\t\t\t\t// 个人觉得应该crash掉让用户修复异常而不是继续执行complete\n\t\t\t\t// 所以这里只是为了还原window上原有的函数而不是为了吞掉异常\n\t\t\t\thasOriginalCb && (window[callbackName] = originalCb);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t};\n\t\twindow[cbName].hasHook = true;\n\t}\n\n\tscript.onerror = function (e) {\n\t\tdocument.body.removeChild(script);\n\t\tif (!hasCustomCbName) {\n\t\t\tdelete window[cbName];\n\t\t}\n\t\t// 都没有的话就继续抛出异常, 方便异常监控系统捕获\n\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\tthrow new Error(`Load script ${url} failed.`);\n\t\t}\n\t\thasErrorCb && error(new Error(`Load script ${url} failed.`), e);\n\t\thasCompleteCb && complete('error');\n\t};\n\n\tscript.onload = () => setTimeout(() => document.body.removeChild(script), 3000);\n\n\tcrossorigin && (script.crossOrigin = crossorigin);\n\tscript.src = url;\n\n\tif (isFn(beforeSend)) {\n\t\tsetTimeout(() => {\n\t\t\t// 允许拦截掉不发送请求\n\t\t\tconst rst = beforeSend(url, options);\n\t\t\trst !== false && document.body.appendChild(script);\n\t\t});\n\t} else {\n\t\tdocument.body.appendChild(script);\n\t}\n}\n\nfunction ajax(options) {\n\tlet {\n\t\turl = location.href,\n\t\tmethod = 'GET',\n\t\tcontentType: reqCtype,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\tdata: reqRawData,\n\t\tdataType: acceptType = 'json',\n\t\terror,\n\t\theaders,\n\t\tmimeType,\n\t\tresponseType = '',\n\t\tusername,\n\t\tpassword,\n\t\tsuccess,\n\t\ttimeout = 0,\n\t\tontimeout,\n\t\tevents,\n\t\tuploadEvents,\n\t\twithCredentials = false,\n\t\tcache = true,\n\t\tserialize,\n\t\tdeserialize\n\t} = options;\n\n\tmethod = method.toUpperCase().trim();\n\t// IE是什么...\n\t// xhr不支持CONNECT, TRACE, TRACK方法\n\tif (!['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'].includes(method)) {\n\t\tthrow new Error(`Invalid HTTP method: ${method}`);\n\t}\n\t// 允许所有callback都没有\n\n\t// 准备数据\n\tif (isStr(reqCtype)) {\n\t\tMIME[reqCtype] && (reqCtype = MIME[reqCtype]);\n\t} else if (reqCtype) {\n\t\tthrow new TypeError(\n\t\t\t'contentType could be \"json\", \"form\", \"html\", \"xml\", \"text\" or other custom string.'\n\t\t);\n\t}\n\n\tconst slz = isFn(serialize)\n\t\t\t? serialize\n\t\t\t: isFn(globalSerialize)\n\t\t\t\t? globalSerialize\n\t\t\t\t: defaultSerialize,\n\t\tdslz = isFn(deserialize)\n\t\t\t? deserialize\n\t\t\t: isFn(globalDeserialize)\n\t\t\t\t? globalDeserialize\n\t\t\t\t: defaultDeserialize,\n\t\tprotocol = /^([\\w-]+:)\\/\\//.exec(url)[1],\n\t\txhr = xhrFactory(),\n\t\thasCompleteCb = isFn(complete),\n\t\thasErrorCb = isFn(error),\n\t\thasSuccessCb = isFn(success);\n\n\tlet reqData,\n\t\terrCalled = false,\n\t\tcompleteCalled = false;\n\t({url, data: reqData} = slz({data: reqRawData, method, contentType: reqCtype, url, cache}));\n\n\t// 初始化xhr\n\txhr._active = true;\n\txhr.open(method, url, true, username, password);\n\n\t// 设置必要的头部\n\tif (reqCtype) {\n\t\txhr.setRequestHeader('Content-Type', reqCtype);\n\t} else if (isStr(reqData)) {\n\t\t// 不在默认参数设json是为了让FormData之类的能够由浏览器自己设置\n\t\t// 这里只对字符串的body设置默认为json\n\t\txhr.setRequestHeader('Content-Type', MIME.json);\n\t}\n\tif (isStr(acceptType)) {\n\t\tMIME[acceptType] && (acceptType = MIME[acceptType]);\n\t\txhr.setRequestHeader('Accept', acceptType);\n\t}\n\tsetHeaders(xhr, headers);\n\n\tisStr(mimeType) && xhr.overrideMimeType(mimeType);\n\n\t// 主要是给progress等事件用, 但存在破坏封装的风险\n\tsetEvents(xhr, events);\n\tsetEvents(xhr.upload, uploadEvents);\n\n\twithCredentials && (xhr.withCredentials = withCredentials);\n\tresponseType && (xhr.responseType = responseType);\n\ttimeout && (xhr.timeout = timeout);\n\tif (isFn(ontimeout)) {\n\t\txhr.ontimeout = ontimeout.bind(null);\n\t} else if (timeout && !isFn(xhr.ontimeout)) {\n\t\txhr.ontimeout = function () {\n\t\t\t// 如果没监听ontimeout但是设置了timeout, window.onerror不会捕获这个错误, 所以手动抛个\n\t\t\tthrow new Error(`Request ${url} timeout.`);\n\t\t};\n\t}\n\n\t// loadend无论同步还是异步请求, 无论前面的事件是否抛异常, 它都会执行\n\tif (isFn(xhr.onloadend)) {\n\t\tconst originalLoadend = xhr.onloadend;\n\t\txhr.onloadend = function (e) {\n\t\t\tresetXhr(this);\n\t\t\toriginalLoadend.call(this, e);\n\t\t};\n\t} else {\n\t\txhr.onloadend = function () {\n\t\t\tresetXhr(this);\n\t\t};\n\t}\n\t// 覆盖掉用户自定义onreadystatechange\n\txhr.onreadystatechange = function (e) {\n\t\tif (this.readyState === 4) {\n\t\t\tif (\n\t\t\t\t(this.status >= 200 && this.status < 300) ||\n\t\t\t\tthis.status == 304 ||\n\t\t\t\t(this.status == 0 && protocol == 'file:')\n\t\t\t) {\n\t\t\t\tconst resCtype = this.getResponseHeader('Content-Type');\n\t\t\t\tconst resData = dslz({\n\t\t\t\t\tdata: this.responseXML || this.response || this.responseText,\n\t\t\t\t\tcontentType: resCtype,\n\t\t\t\t\tacceptType\n\t\t\t\t});\n\t\t\t\t// 异常直接抛\n\t\t\t\thasSuccessCb && success(resData, this, e);\n\t\t\t\thasCompleteCb && complete(this, 'success');\n\t\t\t} else if (this.status !== 0) {\n\t\t\t\t// 这类错误xhr.onerror和window.onerror都不捕获所以手动抛一个\n\t\t\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Remote server error. Status code: ${this.status}, message: ${this.statusText}.`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\t// 理论上来讲好像没必要再注册xhr.onerror了, 因为如果有error那status必然为0\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status\n\t\t\t\t// 但是不加个心里不踏实...总感觉会不会有浏览器没按规范实现\n\t\t\t\t// 不过知名的库页都没监听onerror, 那说明应该是都按规范实现了的\n\t\t\t\t// 但是我要加!!!\n\t\t\t\tif (hasErrorCb) {\n\t\t\t\t\terrCalled = true;\n\t\t\t\t\terror(new Error(`Remote server error. Status code ${this.status}`), this, e);\n\t\t\t\t}\n\t\t\t\tif (hasCompleteCb) {\n\t\t\t\t\tcompleteCalled = true;\n\t\t\t\t\tcomplete(this, 'error');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// 覆盖\n\txhr.onerror = function (e) {\n\t\t// 跨域错误会在这里捕获, 但是window.onerror不捕获, 所以也手动抛一个\n\t\tif (!hasErrorCb && !hasCompleteCb) {\n\t\t\tthrow new Error(`An error occured, maybe crossorigin error. Status code: ${this.status}.`);\n\t\t}\n\t\tif (!errCalled && hasErrorCb) {\n\t\t\terror(new Error('Network error or browser restricted.'), this, e);\n\t\t}\n\t\tif (!completeCalled && hasCompleteCb) {\n\t\t\tcomplete(this, 'error');\n\t\t}\n\t};\n\n\t// 哎...都异步吧\n\tif (isFn(beforeSend)) {\n\t\tsetTimeout(() => {\n\t\t\tconst rst = beforeSend(xhr, options);\n\t\t\trst !== false && xhr.send(reqData || null);\n\t\t});\n\t} else {\n\t\txhr.send(reqData || null);\n\t}\n\t// 不暴露xhr\n\treturn {\n\t\tabort() {\n\t\t\txhr.abort();\n\t\t}\n\t};\n}\n\nfunction ajaxSync(options) {\n\t// 同步请求忽略timeout, responseType, withCredentials, 否则报错\n\t// 同步请求的callback都同步调用, 支持callback只是为了API保持一致\n\tlet {\n\t\turl = location.href,\n\t\tmethod = 'GET',\n\t\tcontentType: reqCtype,\n\t\tbeforeSend,\n\t\tcomplete,\n\t\tdata: reqRawData,\n\t\tdataType: acceptType = 'json',\n\t\terror,\n\t\theaders,\n\t\tmimeType,\n\t\tusername,\n\t\tpassword,\n\t\tsuccess,\n\t\tevents,\n\t\tuploadEvents,\n\t\tcache = true,\n\t\tserialize,\n\t\tdeserialize\n\t} = options;\n\n\tmethod = method.toUpperCase().trim();\n\t// IE是什么...\n\t// xhr不支持CONNECT, TRACE, TRACK方法\n\tif (!['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'].includes(method)) {\n\t\tthrow new Error(`Invalid HTTP method: ${method}`);\n\t}\n\t// 允许所有callback都没有\n\n\t// 准备数据\n\tif (isStr(reqCtype)) {\n\t\tMIME[reqCtype] && (reqCtype = MIME[reqCtype]);\n\t} else if (reqCtype) {\n\t\tthrow new TypeError(\n\t\t\t'contentType could be \"json\", \"form\", \"html\", \"xml\", \"text\" or other custom string.'\n\t\t);\n\t}\n\n\tconst slz = isFn(serialize)\n\t\t\t? serialize\n\t\t\t: isFn(globalSerialize)\n\t\t\t\t? globalSerialize\n\t\t\t\t: defaultSerialize,\n\t\tdslz = isFn(deserialize)\n\t\t\t? deserialize\n\t\t\t: isFn(globalDeserialize)\n\t\t\t\t? globalDeserialize\n\t\t\t\t: defaultDeserialize,\n\t\txhr = xhrFactory();\n\n\tlet reqData;\n\t({url, data: reqData} = slz({data: reqRawData, method, contentType: reqCtype, url, cache}));\n\n\t// 初始化xhr\n\txhr._active = true;\n\txhr.open(method, url, false, username, password);\n\n\t// 设置必要的头部\n\tif (reqCtype) {\n\t\txhr.setRequestHeader('Content-Type', reqCtype);\n\t} else if (isStr(reqData)) {\n\t\t// 不在默认参数设json是为了让FormData之类的能够由浏览器自己设置\n\t\t// 这里只对字符串的body设置默认为json\n\t\txhr.setRequestHeader('Content-Type', MIME.json);\n\t}\n\tif (isStr(acceptType)) {\n\t\tMIME[acceptType] && (acceptType = MIME[acceptType]);\n\t\txhr.setRequestHeader('Accept', acceptType);\n\t}\n\tsetHeaders(xhr, headers);\n\n\tisStr(mimeType) && xhr.overrideMimeType(mimeType);\n\n\t// 主要是给progress等事件用, 但存在破坏封装的风险\n\tsetEvents(xhr, events);\n\tsetEvents(xhr.upload, uploadEvents);\n\n\tif (isFn(beforeSend)) {\n\t\tconst rst = beforeSend(xhr, options);\n\t\treturn (\n\t\t\trst !== false && isolateTryCatch({xhr, reqData, acceptType, dslz, success, error, complete})\n\t\t);\n\t} else {\n\t\treturn isolateTryCatch({xhr, reqData, acceptType, dslz, success, error, complete});\n\t}\n}\n\nexport function config({pool = false, serialize, deserialize} = {}) {\n\tif (pool) {\n\t\txhrPool.length = 0;\n\t\tlet poolSize = typeof pool === 'number' ? pool : 5;\n\t\tif (poolSize < 0) {\n\t\t\tthrow new Error('pool size must >= 0');\n\t\t}\n\t\twhile (poolSize--) {\n\t\t\txhrPool.push(createXhr());\n\t\t}\n\t}\n\tisFn(serialize) && (globalSerialize = serialize);\n\tisFn(deserialize) && (globalDeserialize = deserialize);\n}\n\nexport {ajax, ajaxSync, jsonp};\n\nexport function get(url, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tmethod: 'GET'\n\t});\n}\n\nexport function head(url, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tmethod: 'HEAD'\n\t});\n}\n\nexport function post(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'POST'\n\t});\n}\n\nexport function put(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'PUT'\n\t});\n}\n\nexport function del(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'DELETE'\n\t});\n}\n\nexport function patch(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'PATCH'\n\t});\n}\n\nexport function options(url, data, options) {\n\treturn ajax({\n\t\t...options,\n\t\turl,\n\t\tdata,\n\t\tmethod: 'OPTIONS'\n\t});\n}\n"],"names":["isFn","fn","isJSON","cType","test","isForm","isStr","v","isObj","o","Object","prototype","toString","call","xhrPool","ArrayBufferView","getPrototypeOf","Uint8Array","constructor","MIME","json","form","html","xml","text","events","jsonpId","Date","now","cacheRand","globalSerialize","globalDeserialize","createXhr","xhr","XMLHttpRequest","defineProperty","value","writable","enumerable","resetXhr","_active","timeout","e","forEach","upload","xhrFactory","i","len","length","querystring","obj","keys","map","k","Array","isArray","encodeURIComponent","JSON","stringify","join","defaultSerialize","data","method","contentType","url","cache","indexOf","Document","Blob","FormData","ArrayBuffer","TypeError","defaultDeserialize","acceptType","rst","parse","console","error","setHeaders","headers","setRequestHeader","isolateTryCatch","reqData","dslz","success","complete","hasErrorCb","hasCompleteCb","hasSuccessCb","errOccured","resData","onreadystatechange","readyState","status","Error","statusText","send","resCtype","getResponseHeader","responseXML","response","responseText","err","setEvents","target","evts","filter","includes","jsonp","options","crossorigin","callbackName","beforeSend","hasOriginalCb","window","originalCb","undefined","hasCustomCbName","cbName","script","document","createElement","split","qs","replace","hasHook","onerror","body","removeChild","onload","setTimeout","crossOrigin","src","appendChild","ajax","location","href","reqCtype","reqRawData","dataType","mimeType","responseType","username","password","ontimeout","uploadEvents","withCredentials","serialize","deserialize","toUpperCase","trim","slz","protocol","exec","errCalled","completeCalled","open","overrideMimeType","bind","onloadend","originalLoadend","abort","ajaxSync","config","pool","poolSize","push","get","head","post","put","del","patch"],"mappings":"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"}